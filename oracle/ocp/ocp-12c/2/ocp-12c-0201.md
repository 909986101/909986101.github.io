# 安装 Oracle 数据库软件

Oracle 数据库软件使用 Oracle 通用安装程序（OUI）安装。这是 Oracle 自己的一个产品，用来管理安装和维护许多其他 产品。

## 规划 Oracle 数据库软件的安装

安装过程需要许多先解决条件，其中主要的是软件的可用性和合适的机器。

### 支持的平台

Oracle 数据库曾经支持非常广泛的平台。考虑商业上的可行性，Oracle 公司相应的减少支持的平台。Linux 永远是用于发布的第一个平台。

### 获取 Oracle 数据库软件

Oracle 公司提供 Oracle 数据库软件的公开下载。

软件下载的两个来源是 Oracle 技术网（OTN）和 Oracle 软件交付云。为了到达 OTN 下载网站，访问 `www.oracle.com`，通过 Downloads 选项卡导航至 Oracle Database，并选择可用的最新版本。要使用 Oracle 软件交付云，可访问 `http://edelivery.oracle.com` 并选择 Oracle 数据库的最新版本。

软件以 ZIP 文件的形式提供，并需要四个文件：两个文件用于 Oracle 数据库软件，另两个文件用于网格基础设施（Grid Infrastructure）软件。把它们解压出来（一个目录用于 Oracle 数据库软件，另一个目录用于网格基础设施），就准备就绪了。

### 用户账户

在任何版本的 Unix 和 Linux 系统中，都无法以 root 用户身份安装该软件。但有必要创建拥有该软件的账户。最好的做法是创建一个拥有数据库软件的账户，在创建一个拥有网格基础设施软件的第二个账户：这允许把数据库管理域和系统管理域之间的职责分离。

传统上，这个账户被命名为 oracle，并且把它的主要组设定为 oinstall，次要组是 dba。应该在安装之前创建这些组并把它们分配给 oracle 账户。

在 Windows 上，安装程序会创建一个名为 ORA_DBA 的组并将其分配给运行安装程序的账户。

### 磁盘空间和目录

安装数据库大约需要为 Oracle 主目录（Oracle Home）准备 5GB。Oracle 主目录是 Oracle 产品的安装位置。该目录既可以是本地文件系统，也可以是集群文件系统，但不能是 ASM 磁盘组或原始设备。

推荐的目录结构被称为最佳灵活体系结构（Optimal Flexible Architecture），或 OFA。OFA 的目标是简化多个软件安装的组织过程。其总的想法是，每种产品都应被安装在 Oracle 基目录（Oracle Base）下它自己的 Oracle 主目录中。

Oracle 基目录的推荐命名约定基于以下三个变量

`/pm/s/u`

而对于每个 Oracle 主目录，要在这个基目录后添加一个字面量和更多的变量

`/pm/s/u/product/v/type_[n]`

构成每个数据库的文件都位于 Oracle 基目录加上两个变量后的目录中

`/pm/s/u/q/d`

表 1-1 变量及其建议值

|变量|描述|典型值|
|:-|:-|:-|
|pm|挂载点|`Linux: /u01`<br>`Windows: D:\`|
|s|标准目录名|app|
|u|操作系统安装者的账户|oracle|
|v|软件版本|12.1.0|
|type|产品的类型|dbhome|
|n|安装计数器|1|
|q|内容指示器|oradata|
|d|数据库名称|orc1|

### 先决条件检查

运行 OUI 有先决条件。OUI 的先决条件编写在文件 oraparam.ini 中，并且是非常基本的。

如果这些条件得不到满足，OUI 将拒绝运行。然后还有实际安装该产品的先决条件。这些先决条件被编写到 cvu_prereq.xml 文件中，并作为安装的一部分通过 OUI 进行检查。

## 安装 Oracle 数据库软件

### OUI 产品清单

OUI 创建一个清单，这是一组 XML 文件，它们确切的记录已经安装在机器上的 Oracle 的产品、Oracle 主目录，以及已经被应用到每个主目录的补丁。每当 OUI 或 Opatch 运行时，它做的第一件事就是找到清单并检查它是否已被锁定。

清单及拥有它的操作系统组的位置被存储在一个指针文件中。指针文件有一个特定于平台的名字和位置。在 Linux 中，是 `/etc/oracle/oraInst.loc`。在 Solaris 或 AIX 中，指针文件驻留于 `/var/opt/oracle` 目录。在 Windows 中，清单位置在如下注册表项中定义 `HKEY_LOCAL_MACHINE/SOFTWARE/ORACLE/inst_loc`。

OUI 有不同的版本，如果一个产品自带的 OUI 版本早于机器上已经安装的某一个版本，从现有的 Oracle 主目录使用已安装的版本来安装产品。通常是一个好主意（并且可能确实是必要的）。

### OUI 对话框：交互式安装

要启动 OUI，从该软件解压缩目录的根目录下运行 `runInstaller.sh` shell 脚本（Linux），或 setup.exe 程序（Windows）。对于交互式安装，图形终端必须可用。

表 1-2 是 Linux 的安装程序的 12 个步骤所需要的信息

|步骤|说明|
|:-|:-|
|1：配置安全更新|My Oracle Support 的登陆凭据（可选）|
|2：下载软件更新|启用自动下载 CPU 或 PSU（可选）|
|3：选择安装选项|选择是否把安装和创建或升级数据库连起来|
|4：网格安装选项|为单实例、RAC 或 RAC One 节点创建一个安装|
|5：选择产品语言|默认情况下，只选择英语|
|6：选择数据库版本|选择企业版、标准版或标准版 1|
|7：指定安装位置|指定 Oracle 基目录和 Oracle 主目录|
|8：特权操作系统组|指定管理 Oracle 主目录的组|
|9：执行先决条件检查|验证环境|
|10：总结|对话框的总结|
|11：安装产品|进度监测|
|12：完成|成功完成安装|

第 9 步可能会在一些测试上失败。每个问题都被标记为“警告”或“严重”。单击“修复并再次检查”（Fix and Check Again）按钮将生成一个脚本，并提示你以 root 用户身份运行它。

第 11 步，还包括一个以 root 用户身份运行脚本 root.sh 的提示。这个脚本需要 root 权限来完成某些任务。

### 静默安装和响应文件

使用相应文件驱动 OUI。响应文件由 OUI 读取，包含所有交互式对话框所提出问题的答案。可以在不具备图形化界面的终端设备的系统上进行安装。

在安装软件的根目录的 `/response/` 子目录中提供了一个模板响应文件：db_install.rsp。

可用从 OUI 的交互式运行中产生一个响应文件。启动 OUI 并逐步遍历对话框，在最后一个界面，选中“生成响应文件”复选框，指定一个位置来保存根据前面的对话框自动生成的响应文件，然后取消安装。

使用响应文件启动 OUI

```cmd
setup.exe -silent -responseFile db_install.rsp
```

可以把许多其他的命令行开关传递个安装程序

```bash
./runInstaller -help
```

一个特别有用的开关是 -ignoreSysPrerqs，这允许即使先决条件检查失败，也继续进行静默安装或交互式安装。

### Windows 和 Linux 的区别

- **Linux 上的用户 ID**
  
  拥有软件的操作系统用户，必须被预先创建，而且必须是拥有 Oracle 主目录和管理数据库的操作系统组的成员。习惯上用户被命名为 oracle，而组名为 oinstall 和 dba。要以这个用户身份运行 OUI，而不能以 root 身份运行 OUI。

- **Windows 上的用户 ID**

  OUI 必须以具有管理权限的用户身份运行，并且它会提示安装用户输入拥有 Oracle 主目录的用户名。如果此用户不存在，它将被创建。

- **Linux 上的操作系统组**

  必须预先创建至少一个组，即 OSDBA 组。dba 是习惯性的组名，并且运行安装程序的用户必须是改组的成员。第二个组，习惯上被称为 oinstall，应该是运行 OUI 的用户的主要组。

- **Windows 上的操作系统组**

  组的名称是硬编码的，并将由 OUI 创建。被指定的用户将自动变成这些组的成员。

- Linux 上的 root 脚本

  在安装的最后，有个 shell 脚本必须以 root 用户身份运行。这个脚本执行某些需要 root 权限的更改。而 Windows 并不需要这个步骤，因为 OUI 本身必须已经以具有管理权限的用户身份运行。

## 卸载软件

OUI 的 Welcome 窗口上提供了标记为 Deinstall Products 的按钮。单击此按钮将呈现 Oracle 主目录的列表。选择一个 Oracle 主目录将启用 Remove 按钮。单击此按钮，在 Windows 上会弹出一个告诉你运行如下所示命令的消息框。

```cmd
c:\app\oracle\product\12.1.0\dbhome_2\deinstall\deinstall
```

在 Linux 上，其结果是相似的（虽然正斜杠和反斜杠的使用更加一致）。